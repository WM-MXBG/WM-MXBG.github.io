---
title: IP网络规划与路由设计
date: 2021-09-28 22:30:18
categories: 
- Computer Network
tags: 
- experiment
- note
---

(这是头歌平台上的一个计网实验，我懒得删改内容了，直接把实验报告上传上来了。大家可以跳到文章内自己想看的位置去看）

## 实验目的

1. 区别节点.网段、广播三种类型IP地址 

2. 掌握IP子网掩码的两种表示方法 

3. 明确IP网关含义 

4. 掌握IP子网划分、网络规划的基本方法

5. 熟悉组网仿真工具GNS3使用方法 

6. 学会使用路由器的基本配置命令

7. 深入理解路由表基本结构、路由过程

8. 学会静态路由、默认路由配置基本操作

9. 掌握路由分析、网络连通故障定位的方法

## 实验环境

1. 头歌基于Linux的虚拟机桌面系统
2. 组网仿真工具GNS3 
3. 浏览器firefox
4. 路由跟踪命令traceroute(在Windows平台是tracert)

## 相关原理或知识点

1. IP子网掩码的两种表示方法

   32位IP子网掩码，特点是从高位开始连续都是1，后面是连续的0，它有以下两种表示方法： 

   （1）传统表示法，如：255.255.255.0 

   （2）IP前缀（长度），如：24，表示IP地址的前24位是网络位。

2. 节点、网段、广播三种类型IP地址

   在IP网络中，每个通信节点、IP网段、广播地址都需要用“IP/子网掩码”来表示，并且它们的特征是截然不同的，千万不要弄错。

3. IP子网

   每个IP子网（网段），都对应一个连续的IP地址块（空间），并且这个地址块的起始地址和长度一定是2的幂数。 例如：子网172.16.0.0/24，对应的地址块的起始地址（最小）是该子网的网络地址； 对应的地址块的结束地址（最大）是该子网的广播地址；其余的IP地址属于节点地址，一共有2的8次幂-2=256-2=254个。 

4. 路由表的基本结构

   构成路由表的表项称之为路由项。典型的路由表实例如下：

   <center><b><small> 表3.1&nbsp&nbsp&nbsp&nbsp典型路由表</small></b></center>

| 目标IP/目标掩码 |  协议  | 优先级 | 开销 |   下一跳   |     本地出口     |
| :-------------: | :----: | :----: | :--: | :--------: | :--------------: |
|    8.0.0.0/8    |  RIP   |  100   |  3   | 130.0.0.2  |    Serial1/0     |
|    9.0.0.0/8    |  OSPF  |   10   |  50  | 123.0.3.21 |    Serial1/1     |
|   9.1.0.0/16    |  RIP   |  100   |  4   | 203.9.0.2  |   Ethernet0/0    |
|   9.1.15.0/24   | Static |   60   |  0   | 172.0.31.2 |   Ethernet0/1    |
|   20.0.0.0/24   | Direct |   0    |  0   |            | FastEthernet0/0  |
|   3.3.3.2/32    | Static |   1    |  0   | 192.1.1.2  |    LoopBack0     |
|    0.0.0.0/0    | Static |   1    |  0   |  10.0.1.2  | GigabitEthernet0 |

5、路由表的作用

网络中每台路由器都用到了2个或2个以上的网络接口进行网络互连，这里每个接口称之为路由接口。每个路由接口必须设有一个IP地址，如果该接口所在IP网段还有其它用户主机或服务器，该接口就是它们的IP网关。 路由表的主要作用是用于路由，路由是路由器若干功能中一个最基本的功能。当有一个报文从外部进入路由器后，路由器先判别它是过路报文，还是专门发给自己的报文，如果是过路报文，就要进行路由处理。

6、路由表的静态配置

添加一条静态路由操作命令：`ip route 目标IP 目标掩码 下一跳IP`

删除一条静态路由操作命令：`no ip route 目标IP 目标掩码 下一跳IP`

7、默认路由及其配置

路由表中，目标IP/目标掩码是0/0的路由项。称之为默认路由项。

如果路由表中含有一个默认路由项，理论上任何IP地址跟它都是匹配的。

目标0/0含义：当前路由器中登记的所有的非0/0目标都是已知的，相对于整个网络，其它未登记的都是未知目标，它们可以统一用0/0表示。

默认路由项最大优势：可以表达批量目标，提高了配置工作的效率，但是必须要确保它们有共同的下一跳，否则网络永远无法实现完全互通。

默认路由配置举例：`ip route 0.0.0.0 0.0.0.0 10.10.10.10`

## 实验任务

1. IP地址子网规划并分配好IP地址后填写对应表格
2. 根据IP地址分配表配置PC端和路由各接口的IP地址
3. 配置PC端和路由端之间、路由端和路由端之间的静态路由，查看配置文件并分析
4. 为末梢路由器配置默认路由，进行网络连通测试和路由跟踪测试

## IP网络规划

IP子网地址规划采用的子网划分的方式。

<center>
    <b>
        <small> 
            表5.1&nbsp&nbsp&nbsp&nbsp IP子网地址规划
        </small>
    </b>
</center>


| 网段序号 |    IP地址     | 子网掩码 | 所需IP数 | 网段类型 |    网关IP     | 图中成员节点           |
| :------: | :-----------: | :------: | :------: | :------: | :-----------: | ---------------------- |
|    1     |  192.168.1.0  |    24    |   230    |   用户   | 192.168.1.254 | PC1、R1接口F0/0        |
|    2     | 192.168.2.252 |    30    |    2     |   互连   |      无       | R1接口F0/1、R2接口F0/0 |
|    3     | 192.168.3.252 |    30    |    2     |   互连   |      无       | R2接口F0/1、R3接口F0/0 |
|    4     | 192.168.4.128 |    25    |   100    |   用户   | 192.168.4.129 | R3接口F0/1、PC2        |
|    5     | 192.168.5.252 |    30    |    2     |   互连   |      无       | R2接口F1/0、R4接口F0/0 |
|    6     | 192.168.6.192 |    26    |    60    |   用户   | 192.168.6.193 | R4接口F0/1、PC3        |

首先要划分不同的网段，第一步就是要设置不同的网络标识。既然要设置不同的网络标识，首先就要了解网络标识怎么计算和判定。

网络标识作为网段的划分依据，不同网段的网络标识一定是不一样的，而网络标识是通过IP和子网掩码皆化为二进制后，每一位进行与运算，得到的结果就是网络标识。

拿192.168.1.20/24举例：

IP：11000000.10101000.00000001.00010100

子网掩码：11111111.11111111.11111111.00000000

得出AND结果：11000000.10101000.00000001.00000000 == 192.168.1.0

而A、B、C三类IP的网络标识算法是有差异的，如下所述

> A类：只算第一段
>
> B类：只算第一、二段
>
> C类：算第一、二、三段

因为此次实验采用的是C类IP，所以192.168.1.0是192.168.1.20/24的网络标识，也表明IP-192.168.1.20在192.168.1.0网段内。

**<font color='red'>但是！上面的的网段判定方法只适用于未进行子网划分的情况，进行子网划分后的网络标识计算结果和网段判定就不一样了！</font>**

**子网划分**

谈到了子网划分就先说子网划分，怎么不一样会在子网划分的分析中解答。

子网划分是为了划分不同的网段，而不同的网段意味着不同的网络标识，前面举的例子表达的很清楚了，网络标识是通过IP和子网掩码的与运算所得的。而`与1进行与运算得到的永远是本身，与0进行与运算得到的不一定是本身`，这就表明子网掩码有着决定网络标识结果的能力。

为什么这么说呢，大家注意，IP是由网络地址和主机地址组成的。网段划分划分的是IP的网络地址，网络地址的不同表达出不同的网段，后面的剩余位表达的就是主机地址。所以网段和主机地址是1对N的关系。

比如192.168.1.0网段，前三段是网络地址，后一段是主机地址。在192.168.1.0这个网段内能表达的主机IP范围就是192.168.1.1~192.168.1.254(主机位全0和全1扣除)，这就是1对N。

> 主机位全0表示本网络，全1留作广播地址，所以在保留两位主机位的条件下，排除全0和全1。

在一个网段内网段是不变的，变的只是主机位，这和“`与1进行与运算得到的永远是本身，与0进行与运算得到的不一定是本身`”这句话是不是很契合？子网掩码是1的部分和IP进行与运算得到的结果是不变的，所以可以通过子网掩码1的位数来决定网络地址的位数，进而决定了网段。

现在知道了`子网掩码有着决定网段的能力`。那么上文红字部分所提到的“<font color='red'>进行子网划分后的网络标识计算结果和网段判定就不一样了</font>”的问题就有答案了——子网掩码的1的位数能决定与运算得到的网络标识结果有多少位是不变的，即决定网络地址位数，即决定网段。

那么根据子网数目的需求或者是主机数的需求而进行子网划分后，就不能只是单纯的用与运算结果的前几段进行网段的判定，而是根据子网掩码为1的位数来决定与运算结果的前多少位是用来判定网段。

> 其实一直都是根据子网掩码1的位数，根据前几段判断只是不同类型IP的默认值。

那就那么接下来继续分析子网划分。

子网划分可以根据子网数划分和主机数划分。本实验中题目只要求了所需IP数，即通过主机数划分。

拿第四个网段举进行实例分析，第四个网段所需IP数是100，因为 2^6 < 100 <2^7 ，所以需要主机位数为7，因为主机位数7能表达2^7-2个IP(主机位全0和全1扣除)。

主机数需要7位可以得知IP的网络位是32-7=25位，则子网掩码的前25个位数为1，即子网掩码为255.255.255.128，表格内的子网掩码就填写25，

网段IP可以填192.168.4.0或者192.168.4.128。两者表达的范围分别是192.168.4.1~192.168.4.127和192.168.4.128~192.168.4.254。范围都满足分配100个IP。当IP第四段的第一位为1时，IP和子网掩码与运算的结果为192.168.4.128，即进入了192.168.4.128这个网段，所以192.168.4.0的网段最多就能表示128个IP。

至于为什么第三段是4，只是因为从1递加到4而已。

<center>
    <b>
        <small> 
            表5.2&nbsp&nbsp&nbsp&nbsp IP地址分配表
        </small>
    </b>
</center>


| 序号 |  节点名称  | IP地址/子网掩码  |    网关IP     |
| :--: | :--------: | :--------------: | :-----------: |
|  1   |    PC1     |  192.168.1.1/24  | 192.168.1.254 |
|  2   | R1接口F0/0 | 192.168.1.254/24 |      无       |
|  3   | R1接口F0/1 | 192.168.2.253/30 |      无       |
|  4   | R2接口F0/0 | 192.168.2.254/30 |      无       |
|  5   | R2接口F0/1 | 192.168.3.253/30 |      无       |
|  6   | R3接口F0/0 | 192.168.3.254/30 |      无       |
|  7   | R3接口F0/1 | 192.168.4.129/25 |      无       |
|  8   |    PC2     | 192.168.4.254/25 | 192.168.4.129 |
|  9   | R2接口F1/0 | 192.168.5.253/30 |      无       |
|  10  | R4接口F0/0 | 192.168.5.254/30 |      无       |
|  11  | R4接口F0/1 | 192.168.6.193/26 |      无       |
|  12  |    PC3     | 192.168.6.254/26 | 192.168.6.193 |

分配结点的IP和子网掩码时，同一网段内的两结点所分配的IP在网段内即可，不分大小先后，别相等就行。

**网关IP选择**

网关IP的填写前首先要明确网关位置处于哪个网段，在下图中可以看到三台PC机的节点（e0）分别和R1接口F0/0，R3接口F0/1、R4接口F0/1处于同一网段，网关IP的选择一定是在同一网段上选择的，所以PC2和PC3的网关IP选择分别是192.168.4.x和192.168.6.x，最后一段数字的选择只要在网段范围内就可以，比如PC2的选择范围就是192.168.4.`129`~192.168.4.`254`，PC3的范围就是192.168.6.`193`~192.168.4.`254`。

默认网关地址是主机位除最后一位全置1后得到的，根据网络前缀24可知前24位为网络位，后8位为主机位。比如IP地址/子网掩码为192.168.4.129/25的节点的默认网关就是IP地址192.168.4.1**1111110**（加粗的数字部分为主机位），换算成十进制数即192.168.4.254/25

> 但凡是跟IP地址格式一样的都要加网络前缀，跟子网掩码格式一样的就不用加，假如192.168.4.129/25的网络前缀为27，那么主机位就变成32-27=5位了，即默认网关地址为192.168.4.100**11110** —>193.6.7.158/27 。

![例](https://img-blog.csdnimg.cn/img_convert/eec80f8496e78767205b63633a4805ef.png#pic_center)

<center>
    <b>
        <small> 
            图5.1&nbsp&nbsp&nbsp&nbsp 实验例图
        </small>
    </b>
</center>

## 网络基本配置

1. 在开始配置节点之前我们可以做一些基础准备，比如路由器的命名。因为此次实验初始化后所有路由器名称都默认为`Router`，所以为了观察和记录方便我们可以将四个路由器名称设为R1~R4，流程如下：

   ① 进入特权模式：`enable`

   ② 进入终端配置模式：`conf t`

   ③ 更改路由器名称：`host R1/R2/R3/R4`

2. 配置节点IP

   先配置三台PC机的IP，命令格式为`ip IP地址/子网掩码 网关IP`

   PC1

   ![](https://gitee.com/wm-mxbg/my-image-hosting-service/raw/master/3-1-1.jpg)

   <center>
       <b>
           <small> 
               图6.1&nbsp&nbsp&nbsp&nbsp PC1的IP配置
           </small>
       </b>
   </center>
   
   PC2
   
   ![](https://gitee.com/wm-mxbg/my-image-hosting-service/raw/master/3-1-2.jpg)
   
      <center>
          <b>
              <small> 
                  图6.2&nbsp&nbsp&nbsp&nbsp PC2的IP配置
              </small>
          </b>
      </center>
   
   PC3
   
   ![](https://gitee.com/wm-mxbg/my-image-hosting-service/raw/master/3-1-3.jpg)
   
      <center>
          <b>
              <small> 
                  图6.3&nbsp&nbsp&nbsp&nbsp PC3的IP配置
              </small>
          </b>
      </center>
   
   再配置R1~R4路由器节点的IP，命令格式为`IP 接口IP地址 接口IP的子网掩码`；同时查看接口IP配置是否正确，命令格式为`do show ip int b`
   
   因为初次配置后忘记截图，被初始化后失去了截图的机会，故图片仅展示接口配置，具体的配置接口的命令行用代码展示
   
   首先进入终端配置模式：`conf t`
   
   **R1**
   
      ```c
      int f0/0								//进入f0/0接口模式
      ip add 192.168.1.254 255.255.255.0		//设置IP地址和子网掩码
      no sh									//激活f0/0接口
      int f0/1								//进入f0/1接口模式
      ip add 192.168.2.253 255.255.255.252	//设置IP地址和子网掩码
      no sh									//激活f0/1接口  
      ```
   R2~R4的代码展示将只展示 ip add 的命令

   ![3-1-27](https://img-blog.csdnimg.cn/img_convert/cdc8ac1e681b42b1a3bee192fc398fe0.png#pic_center)

   <center>
       <b>
           <small> 
               图6.4&nbsp&nbsp&nbsp&nbsp R1的IP配置
           </small>
       </b>
   </center>
   
   **R2**
   ```c
   ip add 192.168.2.254 255.255.255.252		
   ip add 192.168.3.253 255.255.255.252	
   ip add 192.168.5.253 255.255.255.252	
   ```
   
   ![3-1-28](https://img-blog.csdnimg.cn/img_convert/3abf65509469a186d96354bebe800010.png#pic_center)

   <center>
       <b>
           <small> 
               图6.5&nbsp&nbsp&nbsp&nbsp R2的IP配置
           </small>
       </b>
   </center>
   
   **R3**

   ```c
   ip add 192.168.3.254 255.255.255.252		
   ip add 192.168.4.129 255.255.255.128
   ```
   ![3-1-29](https://img-blog.csdnimg.cn/img_convert/0653e9b73aa78bfe3d82de28c07d7737.png#pic_center)

   <center>
       <b>
           <small> 
               图6.6&nbsp&nbsp&nbsp&nbsp R3的IP配置
           </small>
       </b>
   </center>
   **R4**
   
   ```c
   ip add 192.168.5.254 255.255.255.252		
   ip add 192.168.6.193 255.255.255.192
   ```
   ![3-1-30](https://img-blog.csdnimg.cn/img_convert/6f17ed3ec55531701146e9401637f33b.png#pic_center)
   
   <center>
       <b>
           <small> 
               图6.7&nbsp&nbsp&nbsp&nbsp R4的IP配置
           </small>
       </b>
   </center>
   
3. 配置分析
   运行命令：`show run`查看配置信息。
   
   ![3-1-24](https://img-blog.csdnimg.cn/img_convert/a36861b46e80c8d6ac959aa1d2dadcbf.png#pic_center)
   
   <center>
    <b>
        <small> 
            图6.8&nbsp&nbsp&nbsp&nbsp R3的配置信息_1
        </small>
    </b>
   </center>
   
   上图的配置信息中并没有太多的有价值信息，如
   
   当前配置大小：`807Bytes`
   
   版本：`12.4`
   
   路由器名称：`R3`
   
   等
   
   ![3-1-25](https://img-blog.csdnimg.cn/img_convert/5f8471eed2d357120aaab5e09c0973c2.png#pic_center)
   
   <center>
       <b>
           <small> 
               图6.9&nbsp&nbsp&nbsp&nbsp R3的配置信息_2
           </small>
       </b>
   </center>
   
   这图的信息比较多：但是类型单一，主要描述的是R3各接口的IP配置信息
   
   R3的f0/0接口：`IP地址/子网掩码为：192.168.3.254/30`
   
   R3的f0/1接口：`IP地址/子网掩码为：192.168.4.129/25`
   
   R3的f1/0接口：`IP地址未分配`
   
   R3的f2/0接口：`IP地址未分配`
   
   因为这个配置是我配完默认路由之后的配置，所以在途中还有R3所配置的路由：
   
   <center>
       <b>
           <small> 
               表7.1&nbsp&nbsp&nbsp&nbsp R3路由配置
           </small>
       </b>
   </center>
   
   | 目标网络号 | 目标掩码  |    下一跳IP     |
   | :--------: | :-------: | :-------------: |
   | `0.0.0.0`  | `0.0.0.0` | `192.168.3.253` |

## 静态路由、默认路由配置

1. **都配置静态路由**

   在配置静态路由的时候一开始我是把所有的路由器都配好了静态路由，而不是只给R2配静态路由，R1、R3、R4配默认路由

   配置静态路由的格式为`ip route 目标网络号 目标掩码 下一跳IP`，同时查看路由配置是否正确，命令格式为：`do show ip route`

   **R1**

   ![3-1-4](https://img-blog.csdnimg.cn/img_convert/80f98b41b7211810cc858561049a5184.png#pic_center)
   
   <center>
       <b>
           <small> 
               图7.1&nbsp&nbsp&nbsp&nbsp R1的静态路由配置
           </small>
       </b>
   </center>
   **R2**
   
   ![3-1-5](https://img-blog.csdnimg.cn/img_convert/dc65fe8d8a4bddacc0c2cadde2e36943.png#pic_center)
   
   <center>
       <b>
           <small> 
               图7.2&nbsp&nbsp&nbsp&nbsp R2的静态路由配置
           </small>
       </b>
   </center>
   
   **R3**
   
   ![3-1-7](https://img-blog.csdnimg.cn/img_convert/319e92ef9042a614dbea167957335d87.png#pic_center)
   
      <center>
          <b>
              <small> 
                  图7.3&nbsp&nbsp&nbsp&nbsp R3的静态路由配置
              </small>
          </b>
      </center>
   
   **R4**
   
   ![3-1-8](https://gitee.com/wm-mxbg/my-image-hosting-service/raw/master/StaticBlog/1744077eb187c0be2dca91942c99083a.png)
   
      <center>
          <b>
              <small> 
                  图7.4&nbsp&nbsp&nbsp&nbsp R4的静态路由配置
              </small>
          </b>
      </center>


2. **配置静态路由和默认路由**

   在经历过全配置静态路由后，按照edu上的要求，为R1、R3、R4三位末梢路由配置默认路由,R2依旧配置静态路由。

   此次试验我配置的默认路由的目标IP和子网掩码都是0：`ip route 0.0.0.0 0.0.0.0 下一跳IP`

   **R1**

   ![3-1-12](https://img-blog.csdnimg.cn/img_convert/53d17371bce230db442bb958f6090ea4.png#pic_center)

   <center>
       <b>
           <small> 
               图7.5&nbsp&nbsp&nbsp&nbsp R1的默认路由配置
           </small>
       </b>
   </center>
   
   **R2**
   
   ![3-1-13](https://img-blog.csdnimg.cn/img_convert/b12818507d55868bd29642b1c23357b3.png#pic_center)
   
   <center>
     <b>
       <small> 
         图7.6&nbsp&nbsp&nbsp&nbsp R2的静态路由配置
       </small>
     </b>
   </center>
   
   **R3**![3-1-14](https://img-blog.csdnimg.cn/img_convert/c7955ab5bbb58b99d8a520e2f7467815.png#pic_center)
   
   <center>
     <b>
       <small> 
         图7.7&nbsp&nbsp&nbsp&nbsp R3的默认路由配置
       </small>
     </b>
   </center>
   
   **R4**![3-1-15](https://img-blog.csdnimg.cn/img_convert/0a6fade2d87ef47911f91c27f189ce37.png#pic_center)
   
   <center>
     <b>
       <small> 
         图7.8&nbsp&nbsp&nbsp&nbsp R3的默认路由配置
       </small>
     </b>
   </center>
   
   仔细观察会发现除了R2，其余路由器的路由配置里都多了很多行非默认路由的配置，这是因为我在一开始全部路由器配置静态路由后接着就配置了默认路由，导致R1、R2、R3三个末梢路由器的路由配置上有了赘余。所以采用 `no ip route 目标网络号 目标掩码 下一跳IP `的命令格式去除R1、R2、R3路由器之前配置的静态路由。
   
   **R1**![3-1-16](https://img-blog.csdnimg.cn/img_convert/388e7cbb318ce1c0845f9b0b014a9c22.png#pic_center)
   
   <center>
     <b>
       <small> 
         图7.9&nbsp&nbsp&nbsp&nbsp R1正确默认路由配置
       </small>
     </b>
   </center>
   
   **R3**
   
   ![3-1-18](https://img-blog.csdnimg.cn/img_convert/5f75d0d814d06962989135d087ad36bd.png#pic_center)
   
   <center>
     <b>
       <small> 
         图7.10&nbsp&nbsp&nbsp&nbsp R3正确默认路由配置
       </small>
     </b>
   </center>
   
   **R4**
   
   ![3-1-19](https://img-blog.csdnimg.cn/img_convert/9de1c1abd60edd379bf3b99216803d46.png#pic_center)
   
   <center>
     <b>
       <small> 
         图7.11&nbsp&nbsp&nbsp&nbsp R4正确默认路由配置
       </small>
     </b>
   </center>
   
   在这里我发现no ip add后查看的路由参数所显示的子网掩码都是24，这和我当初所设的子网掩码是不一致的。而在我被初始化后的二次配置后，我再进行路由查询，所得的路由参数所显示的子网掩码回归正常，是我当初设的子网掩码。
   
   我怀疑是no ip add命令导致的处初始化问题。（可能）

3. **R3路由表及其分析**

   查看R3的路由得

   ![3-1-31](https://img-blog.csdnimg.cn/img_convert/cb0fd8eb9956a97552e2d3d72638a9f4.png#pic_center)

   <center>
       <b>
           <small> 
               图7.12&nbsp&nbsp&nbsp&nbsp R3路由
           </small>
       </b>
   </center>
   
   编辑成表如下
   
      <center>
          <b>
              <small> 
                  表7.1&nbsp&nbsp&nbsp&nbsp R3路由表
              </small>
          </b>
      </center>
   
   | 目标IP/目标掩码 | 协议   | 优先级 | 开销 | 下一跳        | 本地出口         |
   | --------------- | ------ | ------ | ---- | ------------- | ---------------- |
   | 192.168.4.0/25  | Direct | 0      | 0    | /             | FastEthernet0/0  |
   | 192.168.3.0/30  | Direct | 0      | 0    | /             | FastEthernet0/1  |
   | 0.0.0.0/0       | Static | 1      | 0    | 192.168.3.253 | GigabitEthernet0 |
   
   首先看`协议`：
   
   前两行的协议是Direct，表示当前网段直接连接在本地接口上，当为该接口设置好IP地址后，自动会产生该路由项，当为该接口去掉IP地址后，对应的路由项自动会消失。
   
   第三行的协议是Static，表示当前路由项是通过命令添加的，可以通过命令删除。
   
   再看`目标IP/目标掩码`和`本地出口`：
   
   R3路由的f0/0接口的目标IP/掩码为：192.168.4.0/25
   
   R3路由的f0/1接口的目标IP/掩码为：192.168.3.0/30
   
   R3路由的静态目标IP/掩码为：0.0.0.0/0；下一跳的静态IP为192.168.3.253
   
   再看`优先级`和`开销`：
   
   R3路由的f0/0接口和f0/1接口的优先级和开销都为0，匹配选择度高。
   
   R3的被设路由项额的优先级为1，,开销为0，在优先级上匹配选择度低于R3路由本身接口。

4. **R4路由表及其分析**

   查看R3的路由得

   ![3-1-32](https://img-blog.csdnimg.cn/img_convert/a1143479bb130a21e2b95ce6d3037b39.png#pic_center)

   <center>
       <b>
           <small> 
               图7.13&nbsp&nbsp&nbsp&nbsp R4路由
           </small>
       </b>
   </center>
   
   编辑成表如下
   
      <center>
          <b>
              <small> 
                  表7.2&nbsp&nbsp&nbsp&nbsp R4路由表
              </small>
          </b>
      </center>
   
   | 目标IP/目标掩码 |  协议  | 优先级 | 开销 |    下一跳     |     本地出口     |
   | :-------------: | :----: | :----: | :--: | :-----------: | :--------------: |
   | 192.168.5.0/30  | Direct |   0    |  0   |       /       | FastEthernet0/0  |
   | 192.168.6.0/26  | Direct |   0    |  0   |       /       | FastEthernet0/1  |
   |    0.0.0.0/0    | Static |   1    |  0   | 192.168.5.253 | GigabitEthernet0 |
   
   首先看`协议`：
   
   前两行的协议是Direct，表示当前网段直接连接在本地接口上，当为该接口设置好IP地址后，自动会产生该路由项，当为该接口去掉IP地址后，对应的路由项自动会消失。
   
   第三行的协议是Static，表示当前路由项是通过命令添加的，可以通过命令删除。
   
   再看`目标IP/目标掩码`和`本地出口`：
   
   R4路由的f0/0接口的目标IP/掩码为：192.168.5.0/30
   
   R4路由的f0/1接口的目标IP/掩码为：192.168.6.0/26
   
   R4路由的静态目标IP/掩码为：0.0.0.0/0；下一跳的静态IP为192.168.5.253
   
   再看`优先级`和`开销`：
   
   R4路由的f0/0接口和f0/1接口的优先级和开销都为0，匹配选择度高。
   
   R4的被设路由项额的优先级为1，,开销为0，在优先级上匹配选择度低于R3路由本身接口。

5. **网络连通测试**

   在**`1. 都配置静态路由`**中我为每位路由器配置的都是静态路由，网络连通测试结果如下

   ![3-1-9](https://img-blog.csdnimg.cn/img_convert/9949ca06781ecde67899cfc8d75a5e00.png#pic_center)

   <center>
       <b>
           <small> 
               图7.14&nbsp&nbsp&nbsp&nbsp P1连通P3、P1连通P2测试结果
           </small>
       </b>
   </center>
   
   并未有特殊情况。
   
   在**`2. 配置静态路由和默认路由`**中我为R2路由器配置的是静态路由，R1、R3、R4三台路由器配置的是默认路由，网络连通测试结果如下
   
   ![3-1-33](https://img-blog.csdnimg.cn/img_convert/109e7a635ee7fcbeab040c846a03880c.png#pic_center)
   
      <center>
          <b>
              <small> 
                  图7.15&nbsp&nbsp&nbsp&nbsp P1连通P2、P1连通P3测试结果
              </small>
          </b>
      </center>
   
   并连通测试P2时超时现象比较严重。

6. **路由跟踪测试**

   在**`1. 都配置静态路由`**中我为每位路由器配置的都是静态路由，路由跟踪测试结果如下

   ![3-1-11](https://img-blog.csdnimg.cn/img_convert/646c95d75da695f3c8e44e05226d75d4.png#pic_center)

   <center>
       <b>
           <small> 
               图7.16&nbsp&nbsp&nbsp&nbsp P1跟踪P3测试结果
           </small>
       </b>
   </center>
   
   .P1跟踪P3，经过IP顺序为 `PC1——R1(f0/0)——R2(f0/0)——R4(f0/0)——PC3`，图中的四行数据中的ip地址亦是对应顺序的节点IP。
   
   连通间隔距离一样的三个IP（192.168.1.254、192.168.2.254、192.168.5.254）时，网关地址和一个探针超时间隔，在连通间隔距离更远一级的IP（192.168.6.254）时，网关地址和两个探针超时间隔。
   
   > `* `意味着端口不可达或达到最大值（默认为30跳，并且可以使用-m标志进行更改），在每个ttl设置中发送三个探针，并打印一行，显示ttl，网关地址和每个探针的往返时间（所以三个*）。5秒钟内没有响应。超时间隔，将为该探针打印“ *”。
   
   在**`2. 配置静态路由和默认路由`**中我为R2路由器配置的是静态路由，R1、R3、R4三台路由器配置的是默认路由，网络连通测试结果如下
   
   ![3-1-20](https://img-blog.csdnimg.cn/img_convert/78e2aa7924fb58ab7e4cf73b61a9ccf2.png#pic_center)
   
      <center>
          <b>
              <small> 
                  图7.17&nbsp&nbsp&nbsp&nbsp P1跟踪P3测试结果_1
              </small>
          </b>
      </center>
   
   ![3-1-21](https://img-blog.csdnimg.cn/img_convert/ed7f678c0f8e25d6af0446917f19229f.png#pic_center)
   
      <center>
          <b>
              <small> 
                  图7.18&nbsp&nbsp&nbsp&nbsp P1跟踪P3测试结果_2
              </small>
          </b>
      </center>
   
   ![3-1-22](https://img-blog.csdnimg.cn/img_convert/1fd29e1b750861473e5a5cd9f2825b8c.png#pic_center)
   
      <center>
          <b>
              <small> 
                  图7.19&nbsp&nbsp&nbsp&nbsp P1跟踪P3测试结果_3
              </small>
          </b>
      </center>
   
   其中`测试结果_1`是我在第一次配置完后第一次跟踪测试得到的结果，追踪一次后我就没继续尝试，结果第二天被强制初始化了；第二次配置完后无论追踪多少次，都得不到`测试结果_1`。
   
   可能是网路原因，网关和探针之间一直超时间隔；
   
   因为路径上节点数量累加起来没有30，所以原因排除达到最大值；
   
   也可能是因为不知名的路由设置错误，导致端口不可达。
   
   > `* * *`意味着该跃点的路由器不会响应用于跟踪路由的数据包类型，作为追踪者将不了解有关该跃点的任何信息（默认情况下，类Unix上为UDP，而在Windows上为ICMP）。
   
   `测试结果_2`是我在第二次配置完后最少追踪十余次得到的结果。`测试结果_3`是追踪测试最常见的结果，相比于`都配置静态路由`时追踪的结果，因为默认直连`0.0.0.0`，所以少了一个网关和探针的超时间隔，或者说多了一个探针对网关的回应。

## 实验总结

1. **子网规划**

   IP地址的网络规划我还有更多的理解，在实验正文不好阐述，在总结里继续。

   我原本的IP地址网络规划的第三段设置的是1~6递增，这样做的方便之处就是直接在进入主机位所在的第四段之前就已经区分了网段。这种方法是会造成一定的主机位浪费。

   虽然我的网段IP的第四段都是为匹配所需IP数所特意设的起始值，这样相比于起始值都设为0并没有什么进步空间，本质上所占用的位数是一样的，因为网段在第三段开始区分会导致后面的254份可分配IP都被隐形占用了，即使真正使用的IP不够254。

   所以在试验过后我仔细钻研，研究出了一套更加充分利用地址空间的`IP子网地址规划`

   <center>
       <b>
           <small> 
               表8.1&nbsp&nbsp&nbsp&nbsp 新IP子网地址规划表
           </small>
       </b>
   </center>
   
   | 网段序号 |    IP地址     | 子网掩码 | 所需IP数 | 网段类型 |    网关IP     | 图中成员节点           |
   | :------: | :-----------: | :------: | :------: | :------: | :-----------: | ---------------------- |
   |    1     |  192.168.1.0  |    24    |   230    |   用户   | 192.168.1.254 | PC1、R1接口F0/0        |
   |    2     |  192.168.2.0  |    30    |    2     |   互连   |      无       | R1接口F0/1、R2接口F0/0 |
   |    3     |  192.168.2.4  |    30    |    2     |   互连   |      无       | R2接口F0/1、R3接口F0/0 |
   |    4     |  192.168.2.7  |    25    |   100    |   用户   |  192.168.2.9  | R3接口F0/1、PC2        |
   |    5     | 192.168.2.128 |    30    |    2     |   互连   |      无       | R2接口F1/0、R4接口F0/0 |
   |    6     | 192.168.2.131 |    25    |    60    |   用户   | 192.168.2.133 | R4接口F0/1、PC3        |
   
      <center>
          <b>
              <small> 
                  表8.2&nbsp&nbsp&nbsp&nbsp 新IP地址分配表
              </small>
          </b>
      </center>
   
   | 序号 |  节点名称  | IP地址/子网掩码  |    网关IP     |
   | :--: | :--------: | :--------------: | :-----------: |
   |  1   |    PC1     |  192.168.1.1/24  | 192.168.1.254 |
   |  2   | R1接口F0/0 | 192.168.1.254/24 |      无       |
   |  3   | R1接口F0/1 |  192.168.2.1/30  |      无       |
   |  4   | R2接口F0/0 |  192.168.2.2/30  |      无       |
   |  5   | R2接口F0/1 |  192.168.2.5/30  |      无       |
   |  6   | R3接口F0/0 |  192.168.2.6/30  |      无       |
   |  7   | R3接口F0/1 |  192.168.2.8/25  |      无       |
   |  8   |    PC2     | 192.168.2.126/25 |  192.168.2.8  |
   |  9   | R2接口F1/0 | 192.168.2.129/30 |      无       |
   |  10  | R4接口F0/0 | 192.168.2.130/30 |      无       |
   |  11  | R4接口F0/1 | 192.168.2.132/25 |      无       |
   |  12  |    PC3     | 192.168.2.254/25 | 192.168.2.132 |
   
   相比于实验中所采用的子网地址规划，我的第二个网段到第六个网段的第三段值都设为`2`，第六个网段的子网掩码设为`25`充分利用了地址空间。
   
   旧方案的地址空间利用率为`25.984%`
   
   （实际分配的IP数(扣除主机位全0全1)/规定划分的IP数：`(230+100+60+3*2)/(254*6)`）
   
   而新方案的地址空间利用率为`78.884%`
   
   （实际分配的IP数(扣除主机位全0全1)/规定划分的IP数：`(230+100+60+3*2)/(254+119+123+3*2)`）
   
   新方案相比于旧方案节省了`67.060%`空间
   
   （(旧方案规定划分的IP数-新方案规定划分的IP数)/旧方案规定划分的IP数）
   
   下面我将详细解释我这套方案的具体规划：
   
   在做完实验后我就想第二个网段到第六个网段之间所需IP数加起来不足254，这五个网段IP的第三段都设为2呢，即`192.168.2.x`这种，经过我长时间的分析这种方法是可行的。
   
   首先，要明确一点的是，主机位全0和全1是不分配给所需IP的主机的，所以像第二个网段的IP是`192.168.2.0`，网段内分配的IP只有`192.168.2.1`和`192.168.2.2`，`192.168.2.0`和`192.168.2.3`的`2位主机位`分别是全0和全1，所以不能使用。类似的，所有网段都是这样。所以每个网段的表示范围如下(`范围的两端IP在分配范围内`)：
   
      <center>
          <b>
              <small> 
                  表8.3&nbsp&nbsp&nbsp&nbsp IP网段分配IP范围表
              </small>
          </b>
      </center>
   
   | 序号 |  网段IP地址   | 子网掩码 | 所需IP数 |         分配IP范围          |
   | :--: | :-----------: | :------: | :------: | :-------------------------: |
   |  1   |  192.168.1.0  |    24    |   230    |  192.168.1.1~192.168.1.254  |
   |  2   |  192.168.2.0  |    30    |    2     |   192.168.2.1~192.168.2.2   |
   |  3   |  192.168.2.4  |    30    |    2     |   192.168.2.5~192.168.2.6   |
   |  4   |  192.168.2.7  |    25    |   100    |  192.168.2.8~192.168.2.126  |
   |  5   | 192.168.2.128 |    30    |    2     | 192.168.2.129~192.168.2.130 |
   |  6   | 192.168.2.131 |    25    |    60    | 192.168.2.132~192.168.2.254 |
   
   可能各位发现子网掩码是30，只需要分配2个IP的网段的表示范围只有`2`个，那<font color='red'>为什么子网掩码为25，分别需要分配100个IP和60个IP的第四网段及第六网段的表示范围分别有`119`个和`123`个呢？</font>
   
   这就是将IP紧密分配在`192.168.2.x`网段内最容易犯错的点了。
   
   分配的时候可能会觉得所需多少IP，范围就表达多少就行，就像子网掩码是`30`的那几个网段就可以了，但是这个范围结果的背后的逻辑不是这么定的。
   
   我将采取画图的方式来解释这个范围结果的取值逻辑。 ![3-1-34](https://img-blog.csdnimg.cn/img_convert/3cf6d3e7610ac7e6ac544a904c18b5a0.png#pic_center)
   
      <center>
          <b>
              <small> 
                  图8.1&nbsp&nbsp&nbsp&nbsp 分配IP范围表达
              </small>
          </b>
      </center>
   
   起始地址为192.168.2.`8`，因为192.168.2.`7`相对于子网掩码`30`相当于`主机位全1`，而相对于子网掩码`25`则只是分配范围内的一个IP（如果分配IP的最小值是192.168.2.0），所以192.168.2.`7`可以作为第四网段的网段IP，192.168.2.`8`作为第四网段的起始地址。
   
   如果按照惯性思维，将192.168.2.`107`作为分配IP最大值（107-8+1=100），这在表达上是没问题的，但是请注意，子网掩码为`25`的前提下，主机位分配IP最大值为192.168.2.`126`（127就是主机位全1了，128进入下一网段）。这就意味着即使人为的讲分配IP最大值设为192.168.2.`107`,但是192.168.2.`108`~192.168.2.`126`依旧是该网段内的待分配IP，所以第四网段规定划分的IP数为126-8+1=`129`个，而不是认为需要100个就是100个，空间利用率（100/129）就是这么来的。
   
   那么现在还只剩第六网段待解析，第六网段的起始IP是192.168.2.`132`，如果子网掩码不改，依旧是`26`的话，第六网段分配IP最大值将为192.168.2.`190`，而`190-132+1=59<60`，就比所需IP数少1个，导致该网段无法满足需求，所以更改子网掩码为`25`，将使网段内分配IP最大值拔到192.168.2.`254`，此时分配IP范围满足所需IP数（254-132+1=123）。
   
   综上，是我对子网划分的进一步思考和探索，如有错误希望各位同志斧正。

2. **默认路由**

   edu上的知识点指导上给的默认路由例子是ip route `0 0 `10.10.10.10，但是这么输入会报错，真确命令格式应该是ip route` 0.0.0.0 0.0.0.0 `10.10.10.10。
   
   

以上就是我对此次实验的总结，很多总结的分析都在实验正文里表述出来，导致正文语句表述不够规范、总结中并无太多方面总结，如有错误，请各位同志斧正。

